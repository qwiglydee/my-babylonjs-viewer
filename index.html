<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Demo page</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <style>
        body {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: start;
            gap: 16px;
            padding: 16px;
        }

        my-viewer {
            width: 800px;
            height: 600px;
        }

        section {
            margin-bottom: 1rem;
            padding: 1rem;
        }
    </style>
    <script type="module" src="./src/index.ts"></script>
</head>

<body>
    <my-viewer>
        <my-camera autospin zoomFactor="0.6"></my-camera>
        <my-environ>
            <my-sky intensity="0.25"></my-sky>
            <my-ground></my-ground>
        </my-environ>
        <my-model class="base" id="suzanne" src="assets/monkey.glb"></my-model>
        <my-model class="base" id="plane2" src="assets/plane2.glb" selected></my-model>
        <my-model class="base" id="plane3" src="assets/plane3.glb"></my-model>
        <my-model class="part" id="gear1" src="assets/plane-gear1.glb" target="gear" selected></my-model>
        <my-model class="part" id="gear2" src="assets/plane-gear2.glb" target="gear"></my-model>
        <my-part class="part" id="hood" ref="hood"></my-part>
        <my-part class="part" id="tail" ref="tail.002"></my-part>
    </my-viewer>
    <div>
        <section class="border rounded-3 mb-3 p-3">
            <h5>Модель</h5>
            <select name="model" class="form-select">
                <option value="suzanne">suzanne</option>
                <option value="plane2">plane2</option>
                <option value="plane3">plane3</option>
            </select>
        </section>
        <section id="menu-components" class="border rounded-3 rounded-3 mb-3 p-3">
            <h5>Комплектация</h5>
            <div class="form-check">
                <input id="check-g1" type="radio" name="item" value="gear1" class="form-check-input">
                <label for="check-g1" class="form-check-label">Шасси: летнее</label>
            </div>
            <div class="form-check">
                <input id="check-g2" type="radio" name="item" value="gear2" class="form-check-input">
                <label for="check-g2" class="form-check-label">Шасси: зимнее</label>
            </div>
            <div class="form-check">
                <input id="check-p1" type="checkbox" name="item" value="hood" class="form-check-input">
                <label for="check-p1" class="form-check-label">Кабина</label>
            </div>
            <div class="form-check">
                <input id="check-p2" type="checkbox" name="item" value="tail" class="form-check-input">
                <label for="check-p2" class="form-check-label">Хвостик</label>
            </div>
        </section>
    </div>
</body>

<script>
    var my = {
        viewer: document.querySelector("my-viewer"),
        camera: document.querySelector('my-camera'),
        environ: document.querySelector('my-environ'),
        basemodels: document.querySelectorAll('my-model.base'),
        partmodels: document.querySelectorAll('my-model.part'),
        partrefs: document.querySelectorAll('my-part.part'),
    }

    var ui = {
        model: document.querySelector("[name=model]"),
        components: document.querySelector("#menu-components")
    }

    ui.model.addEventListener('change', function (e) {
        let input = e.target;
        let item = document.getElementById(input.value);
        my.basemodels.forEach(m => m.selected = false);
        item.selected = true;
    });

    ui.components.addEventListener('change', function (e) {
        let input = e.target;
        let item = document.getElementById(input.value);
        if (item.target && input.checked) document.querySelectorAll(`[target=${item.target}]`).forEach(it => it.selected = false);
        item.selected = input.checked;
    });

    my.viewer.addEventListener('model-updated', function (e) {
        console.debug(e.type, e.target.id, e.detail);
        let item = e.target;
        if (item.classList.contains('base') && item.enabled) ui.model.value = item.id;
    });

    my.viewer.addEventListener('part-updated', function (e) {
        console.debug(e.type, e.target.id, e.detail);
        let item = e.target;
        let input = ui.components.querySelector(`[value=${item.id}]`);
        input.disabled = item.disabled;
        input.checked = item.selected;
    });

    my.viewer.addEventListener('scene-updated', function (e) {
        console.debug(e.type, e.detail);
        my.partmodels.forEach(item => {
            let input = ui.components.querySelector(`[value=${item.id}]`);
            input.disabled = item.disabled;
            input.checked = item.selected;
            // input.closest(".form-check").hidden = input.disabled;
        });
    });
</script>

</html>