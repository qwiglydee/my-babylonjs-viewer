<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Demo page</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <style>
        body {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: start;
            gap: 16px;
            padding: 16px;
        }

        my-viewer {
            width: 800px;
            height: 600px;
        }

        section {
            margin-bottom: 1rem;
            padding: 1rem;
        }
    </style>
    <script type="module" src="./src/index.ts"></script>
</head>

<body>
    <my-viewer>
        <my-camera autospin autospinDelay="5000" autozoom></my-camera>
        <my-environ>
            <my-sky intensity="0.25" blurring="0.75"></my-sky>
            <my-ground></my-ground>
        </my-environ>
        <!-- <my-stub></my-stub> -->
        <my-model class="base" id="suzanne" src="assets/monkey.glb" selected></my-model>
        <my-model class="base" id="plane2" src="assets/plane2.glb"></my-model>
        <my-model class="base" id="plane3" src="assets/plane3.glb"></my-model>
        <my-model class="part" id="gear1" src="assets/plane-gear1.glb" anchor="gear" selected></my-model>
        <my-model class="part" id="gear2" src="assets/plane-gear2.glb" anchor="gear"></my-model>
        <my-part class="part" id="hood" target="hood"></my-part>
        <my-part class="part" id="tail" target="tail.002"></my-part>
    </my-viewer>
    <div>
        <section class="border rounded-3 mb-3 p-3">
            <h5>Модель</h5>
            <select name="model" class="form-select">
                <option value="suzanne">suzanne</option>
                <option value="plane2">plane2</option>
                <option value="plane3">plane3</option>
            </select>
        </section>
        <section id="menu-items" class="border rounded-3 rounded-3 mb-3 p-3">
            <h5>Комплектация</h5>
            <div class="form-check">
                <input id="check-g1" type="radio" name="item" value="gear1" class="form-check-input">
                <label for="check-g1" class="form-check-label">Шасси: летнее</label>
            </div>
            <div class="form-check">
                <input id="check-g2" type="radio" name="item" value="gear2" class="form-check-input">
                <label for="check-g2" class="form-check-label">Шасси: зимнее</label>
            </div>
            <div class="form-check">
                <input id="check-p1" type="checkbox" name="item" value="hood" class="form-check-input">
                <label for="check-p1" class="form-check-label">Кабина</label>
            </div>
            <div class="form-check">
                <input id="check-p2" type="checkbox" name="item" value="tail" class="form-check-input">
                <label for="check-p2" class="form-check-label">Хвостик</label>
            </div>
        </section>
        <section id="menu-skins" class="border rounded-3 rounded-3 mb-3 p-3">
            <h5>Расцветка</h5>
            <div class="form-check">
                <input id="check-s1" type="radio" name="skin" value="acrobatic" class="form-check-input">
                <label for="check-s1" class="form-check-label">Акробатическая</label>
            </div>
            <div class="form-check">
                <input id="check-s2" type="radio" name="skin" value="fighter" class="form-check-input">
                <label for="check-s2" class="form-check-label">Боевая</label>
            </div>
        </section>
    </div>
</body>

<script>
    var my = {
        viewer: document.querySelector("my-viewer"),
        camera: document.querySelector('my-camera'),
        environ: document.querySelector('my-environ'),
        basemodels: document.querySelectorAll('my-model.base'),
        partmodels: document.querySelectorAll('my-model.part'),
        modelparts: document.querySelectorAll('my-part.part'),
    }

    var ui = {
        model: document.querySelector("[name=model]"),
        items: document.querySelector("#menu-items"),
        skins: document.querySelector("#menu-skins")
    }

    ui.model.addEventListener('change', function (e) {
        let input = e.target;
        let item = document.getElementById(input.value);
        my.basemodels.forEach(m => m.selected = m.id == input.value);
    });

    ui.items.addEventListener('change', function (e) {
        let input = e.target;
        let item = document.getElementById(input.value);
        item.selected = input.checked;
        document.querySelectorAll(`[anchor=${item.anchor}]`).forEach(it => { if (it !== item) it.selected = false });
    });

    ui.skins.addEventListener('change', function (e) {
        let input = e.target;
        my.basemodels.forEach(m => m.skin = input.value);
        my.partmodels.forEach(m => m.skin = input.value);
    });

    my.viewer.addEventListener('model-updated', function (e) {
        console.debug(e.type, e.target.id, e.detail);
        let item = e.target;
        if (item.classList.contains('base') && item.selected) {
            // after actual scene update
            setTimeout(() => my.camera.reset(), 17);
        }
    });

    my.viewer.addEventListener('part-updated', function (e) {
        console.debug(e.type, e.target.id, e.detail);    
    });

    my.viewer.addEventListener('scene-updated', function (e) {
        console.debug(e.type, e.detail);
        
        my.basemodels.forEach(item => {
            if (item.selected) ui.model.value = item.id;
        })

        my.partmodels.forEach(item => {
            let input = ui.items.querySelector(`[value=${item.id}]`);
            input.disabled = item.disabled;
            input.checked = item.selected;
        });

        my.modelparts.forEach(item => {
            let input = ui.items.querySelector(`[value=${item.id}]`);
            input.disabled = item.disabled;
            input.checked = item.selected;
        });
    });
</script>

</html>